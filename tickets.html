<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Paradise Tickets</title>
<style>
body{font-family:sans-serif;background:#0f0f1f;color:white;padding:20px;}
button{padding:10px 18px;margin-top:10px;background:#7c3aed;border:none;color:white;border-radius:6px;cursor:pointer;}
#tickets{margin-top:20px;}
.ticket{padding:12px;margin:8px 0;border:1px solid #7c3aed;border-radius:8px;}
</style>
</head>
<body>

<h1>Open a Ticket</h1>
<button id="openTicketBtn">Open Ticket</button>
<div id="tickets"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyAWqZClZUwdAoiRXNlWDWFdx2ggrmxdWSE",
    authDomain: "paradise-community.firebaseapp.com",
    databaseURL: "https://paradise-community-default-rtdb.firebaseio.com/",
    projectId: "paradise-community",
    storageBucket: "paradise-community.firebasestorage.app",
    messagingSenderId: "967977031344",
    appId: "1:967977031344:web:6408921ddbd62559f84d75"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Utils
function generateId(len=6){return Math.random().toString(36).substr(2,len);}

// Open ticket
document.getElementById('openTicketBtn').addEventListener('click', async ()=>{
    const ticketsSnapshot = await db.ref('tickets').once('value');
    const tickets = ticketsSnapshot.val() || {};
    if(Object.keys(tickets).length >= 10){
        alert("Maximum of 10 tickets open at a time.");
        return;
    }
    const ticketId = generateId(8);
    const ticketData = {id: ticketId, status:'open', lastUpdated: Date.now()};
    await db.ref('tickets/'+ticketId).set(ticketData);
    alert(`Ticket opened! Visit: ticket.html?id=${ticketId}`);
});

// Auto-close tickets after 10 min inactivity
setInterval(async ()=>{
    const ticketsSnapshot = await db.ref('tickets').once('value');
    const tickets = ticketsSnapshot.val() || {};
    const now = Date.now();
    for(const [id, t] of Object.entries(tickets)){
        if(t.status==='open' && now - t.lastUpdated > 10*60*1000){
            db.ref('tickets/'+id).update({status:'closed'});
        }
    }
},60*1000);

// Show user's open tickets
async function renderTickets(){
    const ticketsDiv = document.getElementById('tickets');
    ticketsDiv.innerHTML = '';
    const snapshot = await db.ref('tickets').once('value');
    const tickets = snapshot.val() || {};
    for(const [id, t] of Object.entries(tickets)){
        const div = document.createElement('div');
        div.className='ticket';
        div.innerHTML=`Ticket ID: <b>${id}</b> â€” Status: <b>${t.status}</b>`;
        ticketsDiv.appendChild(div);
    }
}
setInterval(renderTickets,3000);
renderTickets();
</script>
</body>
</html>
